{
  "version": "0.3.1",
  "name": "Media preparation for medium 88370C",
  "description": "This recipe uses the biofeed module for preparing medium 88370C in 9 steps. This recipe approximately lasts 75min.",
  "author": "Markus Graube <markus.graube@tu-dresden.de>",
  "initial_step": "S1.AddWater",
  "steps": [
    {
      "name": "S1.AddWater",
      "operations": [
        {
          "service": "FeedWater", "command": "start",
          "parameter": [
            { "name": "TargetVolume", "value": 3500}
          ]
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "FeedWater", "state": "completed" },
          "next_step": "S1.WaitForIdle"
        }
      ]
    },
    {
      "name": "S1.WaitForIdle",
      "operations": [ ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "FeedWater", "state": "idle" },
          "next_step": "S2.AddPowder"
        }
      ]
    },
    {
      "name": "S2.AddPowder",
      "operations": [
        {
          "service": "FeedPowder", "command": "start",
          "parameter": [ { "name": "FeedMass", "value": 142.85 } ]
        },
        {
          "service": "Stirring", "command": "start",
          "parameter": [
            { "name": "StirringRotationSpeed", "value": 300 },
            { "name": "StirringDuration", "value": 420 }
          ]
        }
      ],
      "transitions": [
        {
          "condition": {"type": "state", "service": "Stirring", "state": "completed"},
          "next_step": "S2.StopStirring"
        }
      ]
    },
    {
      "name": "S2.StopStirring",
      "operations": [
        { "service": "Stirring", "command": "complete" }
      ],
      "transitions": [
        {
          "condition": { "type": "time", "duration": 20 },
          "next_step": "S2.AddAdditionalWater"
        }
      ]
    },
    {
      "name": "S2.AddAdditionalWater",
      "operations": [
        {
          "service": "FeedWater", "command": "start",
          "parameter": [
            {  "name": "TargetVolume", "value": 4000 }
          ]
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "FeedWater", "state": "completed" },
          "next_step": "S2.AddAdditionalWaterIdle"
        }
      ]
    },
    {
      "name": "S2.AddAdditionalWaterIdle",
      "operations": [ ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "FeedWater", "state": "idle" },
          "next_step": "S2.Stirr"
        }
      ]
    },
    {
      "name": "S2.Stirr",
      "operations": [
        {
          "service": "Stirring", "command": "start",
          "parameter": [
            { "name": "StirringRotationSpeed", "value": 300},
            { "name": "StirringDuration", "value": 600}
          ]
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "Stirring", "state": "completed" },
          "next_step": "S2.StirrIdle"
        }
      ]
    },
    {
      "name": "S2.StirrIdle",
      "operations": [ ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "Stirring", "state": "idle" },
          "next_step": "S3.pH4.5"
        }
      ]
    },
    {
      "name": "S3.pH4.5",
      "operations": [
        {
          "service": "pHAdjustment", "command": "start",
          "parameter": [
            { "name": "DelayTime", "value": 5 },
            { "name": "TargetVolume", "value": 5 },
            { "name": "pHValue", "value": 4.5 }
          ]
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "pHAdjustment", "state": "completed"},
          "next_step": "S3.pH4.5Idle"
        }
      ]
    },
    {
      "name": "S3.pH4.5Idle",
      "operations": [ ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "pHAdjustment", "state": "idle"},
          "next_step": "S4.addBicarb"
        }
      ]
    },
    {
      "name": "S4.addBicarb",
      "operations": [
        {
          "service": "FeedBufferSolution", "command": "start",
          "parameter": [
            { "name": "TargetVolume", "value": 83 }
          ]
        },
        {
          "service": "Stirring", "command": "start",
          "parameter": [
            { "name": "StirringRotationSpeed", "value": 300 },
            { "name": "StirringDuration", "value": 600 }
          ]
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "Stirring", "state": "completed" },
          "next_step": "S4.addBicarbIdle"
        }
      ]
    },
    {
      "name": "S4.addBicarbIdle",
      "operations": [ ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "Stirring", "state": "idle" },
          "next_step": "S5.ph9"
        }
      ]
    },
    {
      "name": "S5.ph9",
      "operations": [
        {
          "service": "pHAdjustment", "command": "start",
          "parameter": [
            { "name": "pHValue", "value": 9 },
            { "name": "TargetVolume", "value": 5 },
            { "name": "DelayTime", "value": 5 }
          ]
        },
        {
          "service": "Stirring", "command": "start",
          "parameter": [
            { "name": "StirringRotationSpeed", "value": 300 },
            { "name": "StirringDuration", "value": 0 }
          ]
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "pHAdjustment", "state": "completed" },
          "next_step": "S5.stopStirr"
        }
      ]
    },
    {
      "name": "S5.stopStirr",
      "operations": [
        {
          "service": "Stirring", "command": "complete"
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "Stirring", "state": "idle" },
          "next_step": "S5.Stirr10min"
        }
      ]
    },
    {
      "name": "S5.Stirr10min",
      "operations": [
        {
          "service": "Stirring", "command": "start",
          "parameter": [
            { "name": "StirringRotationSpeed", "value": 300 },
            { "name": "StirringDuration", "value": 600 }
          ]
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "Stirring", "state": "completed" },
          "next_step": "S5.Stirr10minIdle"
        }
      ]
    },
    {
      "name": "S5.Stirr10minIdle",
      "operations": [],
      "transitions": [
        {
          "condition": { "type": "state", "service": "Stirring", "state": "idle"},
          "next_step": "S6.ph7"
        }
      ]
    },
    {
      "name": "S6.ph7",
      "operations": [
        {
          "service": "pHAdjustment", "command": "start",
          "parameter": [
            { "name": "pHValue", "value": 7.3 },
            { "name": "TargetVolume", "value": 2},
            { "name": "DelayTime", "value": 5 }
          ]
        },
        {
          "service": "Stirring", "command": "start",
          "parameter": [
            { "name": "StirringRotationSpeed", "value": 300 },
            { "name": "StirringDuration", "value": 0 }
          ]
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "pHAdjustment", "state": "completed" },
          "next_step": "S6.stopStirr"
        }
      ]
    },
    {
      "name": "S6.stopStirr",
      "operations": [
        {
          "service": "Stirring", "command": "complete"
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "Stirring", "state": "idle" },
          "next_step": "S7.FinalVolume"
        }
      ]
    },
    {
      "name": "S7.FinalVolume",
      "operations": [
        {
          "service": "FeedWater", "command": "start",
          "parameter": [
            { "name": "TargetVolume", "value": 5000 }
          ]
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "FeedWater", "state": "completed" },
          "next_step": "S7.FinalVolumeIdle"
        }
      ]
    },
    {
      "name": "S7.FinalVolumeIdle",
      "operations": [ ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "FeedWater", "state": "idle" },
          "next_step": "S8.FiltrationToStorage"
        }
      ]
    },
    {
      "name": "S8.FiltrationToStorage",
      "operations": [
        {
          "service": "FiltrationToStorageQualityBased", "command": "start"
        }
      ],
      "transitions": [
        {
          "condition": { "type": "state", "service": "FiltrationToStorageQualityBased", "state": "completed" },
          "next_step": "completed"
        }
      ]
    }
  ]
}